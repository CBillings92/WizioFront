THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){function e(n){if(!1!==n.visible){if(n instanceof THREE.Light)A.lights.push(n);else if(n instanceof THREE.Mesh||n instanceof THREE.Line||n instanceof THREE.Points){if(!1===n.material.visible)return;if(!0===n.frustumCulled&&!1===I.intersectsObject(n))return;t(n)}else if(n instanceof THREE.Sprite){if(!1===n.material.visible)return;if(!0===n.frustumCulled&&!1===I.intersectsSprite(n))return;t(n)}for(var i=n.children,o=0,r=i.length;o<r;o++)e(i[o])}}function t(e){(h=i()).id=e.id,h.object=e,z.setFromMatrixPosition(e.matrixWorld),z.applyMatrix4(U),h.z=z.z,h.renderOrder=e.renderOrder,A.objects.push(h)}function n(e,t,n){var i=1/e.w;e.z*=i,e.z>=-1&&e.z<=1&&((T=s()).id=t.id,T.x=e.x*i,T.y=e.y*i,T.z=e.z,T.renderOrder=t.renderOrder,T.object=t,T.rotation=t.rotation,T.scale.x=t.scale.x*Math.abs(T.x-(e.x+n.projectionMatrix.elements[0])/(e.w+n.projectionMatrix.elements[12])),T.scale.y=t.scale.y*Math.abs(T.y-(e.y+n.projectionMatrix.elements[5])/(e.w+n.projectionMatrix.elements[13])),T.material=t.material,A.elements.push(T))}function i(){if(p===M){var e=new THREE.RenderableObject;return g.push(e),M++,p++,e}return g[p++]}function o(){if(d===w){var e=new THREE.RenderableVertex;return x.push(e),w++,d++,e}return x[d++]}function r(){if(m===b){var e=new THREE.RenderableFace;return H.push(e),b++,m++,e}return H[m++]}function a(){if(v===S){var e=new THREE.RenderableLine;return O.push(e),S++,v++,e}return O[v++]}function s(){if(R===L){var e=new THREE.RenderableSprite;return C.push(e),L++,R++,e}return C[R++]}function c(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function l(e,t){var n=0,i=1,o=e.z+e.w,r=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return o>=0&&r>=0&&a>=0&&s>=0||!(o<0&&r<0||a<0&&s<0)&&(o<0?n=Math.max(n,o/(o-r)):r<0&&(i=Math.min(i,o/(o-r))),a<0?n=Math.max(n,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<n)&&(e.lerp(t,n),t.lerp(e,1-i),!0))}var h,p,u,d,E,m,f,v,T,R,y,g=[],M=0,x=[],w=0,H=[],b=0,O=[],S=0,C=[],L=0,A={objects:[],lights:[],elements:[]},z=new THREE.Vector3,N=new THREE.Vector4,j=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),V=new THREE.Box3,D=new Array(3),P=new THREE.Matrix4,U=new THREE.Matrix4,k=new THREE.Matrix4,B=new THREE.Matrix3,I=new THREE.Frustum,Y=new THREE.Vector4,_=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var F=new function(){function e(e){var t=e.position,n=e.positionWorld,i=e.positionScreen;n.copy(t).applyMatrix4(y),i.copy(n).applyMatrix4(U);var o=1/i.w;i.x*=o,i.y*=o,i.z*=o,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1}function t(e,t,n){return!0===e.visible||!0===t.visible||!0===n.visible||(D[0]=e.positionScreen,D[1]=t.positionScreen,D[2]=n.positionScreen,j.intersectsBox(V.setFromPoints(D)))}function n(e,t,n){return(n.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(n.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}var i=[],s=[],c=[],h=null,p=null,d=new THREE.Matrix3;return{setObject:function(e){p=(h=e).material,d.getNormalMatrix(h.matrixWorld),i.length=0,s.length=0,c.length=0},projectVertex:e,checkTriangleVisibility:t,checkBackfaceCulling:n,pushVertex:function(t,n,i){(u=o()).position.set(t,n,i),e(u)},pushNormal:function(e,t,n){i.push(e,t,n)},pushColor:function(e,t,n){s.push(e,t,n)},pushUv:function(e,t){c.push(e,t)},pushLine:function(e,t){var n=x[e],i=x[t];n.positionScreen.copy(n.position).applyMatrix4(k),i.positionScreen.copy(i.position).applyMatrix4(k),!0===l(n.positionScreen,i.positionScreen)&&(n.positionScreen.multiplyScalar(1/n.positionScreen.w),i.positionScreen.multiplyScalar(1/i.positionScreen.w),(f=a()).id=h.id,f.v1.copy(n),f.v2.copy(i),f.z=Math.max(n.positionScreen.z,i.positionScreen.z),f.renderOrder=h.renderOrder,f.material=h.material,h.material.vertexColors===THREE.VertexColors&&(f.vertexColors[0].fromArray(s,3*e),f.vertexColors[1].fromArray(s,3*t)),A.elements.push(f))},pushTriangle:function(e,o,a){var s=x[e],l=x[o],u=x[a];if(!1!==t(s,l,u)&&(p.side===THREE.DoubleSide||!0===n(s,l,u))){(E=r()).id=h.id,E.v1.copy(s),E.v2.copy(l),E.v3.copy(u),E.z=(s.positionScreen.z+l.positionScreen.z+u.positionScreen.z)/3,E.renderOrder=h.renderOrder,E.normalModel.fromArray(i,3*e),E.normalModel.applyMatrix3(d).normalize();for(var m=0;m<3;m++){var f=E.vertexNormalsModel[m];f.fromArray(i,3*arguments[m]),f.applyMatrix3(d).normalize(),E.uvs[m].fromArray(c,2*arguments[m])}E.vertexNormalsLength=3,E.material=h.material,A.elements.push(E)}}}};this.projectScene=function(t,i,s,h){m=0,v=0,R=0,A.elements.length=0,!0===t.autoUpdate&&t.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),P.copy(i.matrixWorldInverse.getInverse(i.matrixWorld)),U.multiplyMatrices(i.projectionMatrix,P),I.setFromMatrix(U),p=0,A.objects.length=0,A.lights.length=0,e(t),!0===s&&A.objects.sort(c);for(var u=A.objects,T=0,g=u.length;T<g;T++){var M=u[T].object,w=M.geometry;if(F.setObject(M),y=M.matrixWorld,d=0,M instanceof THREE.Mesh){if(w instanceof THREE.BufferGeometry){var H=w.attributes,b=w.groups;if(void 0===H.position)continue;for(var O=0,S=(Te=H.position.array).length;O<S;O+=3)F.pushVertex(Te[O],Te[O+1],Te[O+2]);if(void 0!==H.normal)for(var C=H.normal.array,O=0,S=C.length;O<S;O+=3)F.pushNormal(C[O],C[O+1],C[O+2]);if(void 0!==H.uv)for(var L=H.uv.array,O=0,S=L.length;O<S;O+=2)F.pushUv(L[O],L[O+1]);if(null!==w.index){var j=w.index.array;if(b.length>0)for(var V=0;V<b.length;V++)for(var D=b[V],O=D.start,S=D.start+D.count;O<S;O+=3)F.pushTriangle(j[O],j[O+1],j[O+2]);else for(var O=0,S=j.length;O<S;O+=3)F.pushTriangle(j[O],j[O+1],j[O+2])}else for(var O=0,S=Te.length/3;O<S;O+=3)F.pushTriangle(O,O+1,O+2)}else if(w instanceof THREE.Geometry){var X=w.vertices,W=w.faces,Z=w.faceVertexUvs[0];B.getNormalMatrix(y);for(var Q=M.material,q=Array.isArray(Q),G=0,K=X.length;G<K;G++){ge=X[G];if(z.copy(ge),!0===Q.morphTargets)for(var J=w.morphTargets,$=M.morphTargetInfluences,ee=0,te=J.length;ee<te;ee++){var ne=$[ee];if(0!==ne){var ie=J[ee].vertices[G];z.x+=(ie.x-ge.x)*ne,z.y+=(ie.y-ge.y)*ne,z.z+=(ie.z-ge.z)*ne}}F.pushVertex(z.x,z.y,z.z)}for(var oe=0,re=W.length;oe<re;oe++){var ae=W[oe];if(void 0!==(Q=!0===q?M.material[ae.materialIndex]:M.material)){var se=Q.side,ce=x[ae.a],le=x[ae.b],he=x[ae.c];if(!1!==F.checkTriangleVisibility(ce,le,he)){var pe=F.checkBackfaceCulling(ce,le,he);if(se!==THREE.DoubleSide){if(se===THREE.FrontSide&&!1===pe)continue;if(se===THREE.BackSide&&!0===pe)continue}(E=r()).id=M.id,E.v1.copy(ce),E.v2.copy(le),E.v3.copy(he),E.normalModel.copy(ae.normal),!1!==pe||se!==THREE.BackSide&&se!==THREE.DoubleSide||E.normalModel.negate(),E.normalModel.applyMatrix3(B).normalize();for(var ue=ae.vertexNormals,de=0,Ee=Math.min(ue.length,3);de<Ee;de++){var me=E.vertexNormalsModel[de];me.copy(ue[de]),!1!==pe||se!==THREE.BackSide&&se!==THREE.DoubleSide||me.negate(),me.applyMatrix3(B).normalize()}E.vertexNormalsLength=ue.length;var fe=Z[oe];if(void 0!==fe)for(var ve=0;ve<3;ve++)E.uvs[ve].copy(fe[ve]);E.color=ae.color,E.material=Q,E.z=(ce.positionScreen.z+le.positionScreen.z+he.positionScreen.z)/3,E.renderOrder=M.renderOrder,A.elements.push(E)}}}}}else if(M instanceof THREE.Line){if(k.multiplyMatrices(U,y),w instanceof THREE.BufferGeometry){if(void 0!==(H=w.attributes).position){for(var Te=H.position.array,O=0,S=Te.length;O<S;O+=3)F.pushVertex(Te[O],Te[O+1],Te[O+2]);if(void 0!==H.color)for(var Re=H.color.array,O=0,S=Re.length;O<S;O+=3)F.pushColor(Re[O],Re[O+1],Re[O+2]);if(null!==w.index)for(var O=0,S=(j=w.index.array).length;O<S;O+=2)F.pushLine(j[O],j[O+1]);else for(var ye=M instanceof THREE.LineSegments?2:1,O=0,S=Te.length/3-1;O<S;O+=ye)F.pushLine(O,O+1)}}else if(w instanceof THREE.Geometry){if(0===(X=M.geometry.vertices).length)continue;(ce=o()).positionScreen.copy(X[0]).applyMatrix4(k);for(var ye=M instanceof THREE.LineSegments?2:1,G=1,K=X.length;G<K;G++)(ce=o()).positionScreen.copy(X[G]).applyMatrix4(k),(G+1)%ye>0||(le=x[d-2],Y.copy(ce.positionScreen),_.copy(le.positionScreen),!0===l(Y,_)&&(Y.multiplyScalar(1/Y.w),_.multiplyScalar(1/_.w),(f=a()).id=M.id,f.v1.positionScreen.copy(Y),f.v2.positionScreen.copy(_),f.z=Math.max(Y.z,_.z),f.renderOrder=M.renderOrder,f.material=M.material,M.material.vertexColors===THREE.VertexColors&&(f.vertexColors[0].copy(M.geometry.colors[G]),f.vertexColors[1].copy(M.geometry.colors[G-1])),A.elements.push(f)))}}else if(M instanceof THREE.Points){if(k.multiplyMatrices(U,y),w instanceof THREE.Geometry)for(var G=0,K=(X=M.geometry.vertices).length;G<K;G++){var ge=X[G];N.set(ge.x,ge.y,ge.z,1),N.applyMatrix4(k),n(N,M,i)}}else M instanceof THREE.Sprite&&(N.set(y.elements[12],y.elements[13],y.elements[14],1),N.applyMatrix4(U),n(N,M,i))}return!0===h&&A.elements.sort(c),A}},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.isSpriteCanvasMaterial=!0,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){function t(){fe.setRGB(0,0,0),ve.setRGB(0,0,0),Te.setRGB(0,0,0);for(var e=0,t=M.length;e<t;e++){var n=M[e],i=n.color;n.isAmbientLight?fe.add(i):n.isDirectionalLight?ve.add(i):n.isPointLight&&Te.add(i)}}function n(e,t,n){for(var i=0,o=M.length;i<o;i++){var r=M[i];if(pe.copy(r.color),r.isDirectionalLight){a=Re.setFromMatrixPosition(r.matrixWorld).normalize();if((s=t.dot(a))<=0)continue;s*=r.intensity,n.add(pe.multiplyScalar(s))}else if(r.isPointLight){var a=Re.setFromMatrixPosition(r.matrixWorld),s=t.dot(Re.subVectors(a,e).normalize());if(s<=0)continue;if(0==(s*=0==r.distance?1:1-Math.min(e.distanceTo(a)/r.distance,1)))continue;s*=r.intensity,n.add(pe.multiplyScalar(s))}}}function i(e,t,n){u(n.opacity),d(n.blending);var i=t.scale.x*F,o=t.scale.y*X,r=Math.sqrt(i*i+o*o);if(me.min.set(e.x-r,e.y-r),me.max.set(e.x+r,e.y+r),n.isSpriteMaterial){var a=n.map;if(null!==a){var s=ue[a.id];if(void 0!==s&&s.version===a.version||(s=l(a),ue[a.id]=s),void 0!==s.canvas){T(s.canvas);var c=a.image,h=c.width*a.offset.x,p=c.height*a.offset.y,E=c.width*a.repeat.x,m=c.height*a.repeat.y,f=i/E,R=o/m;K.save(),K.translate(e.x,e.y),0!==n.rotation&&K.rotate(n.rotation),K.translate(-i/2,-o/2),K.scale(f,R),K.translate(-h,-p),K.fillRect(h,p,E,m),K.restore()}}else T(n.color.getStyle()),K.save(),K.translate(e.x,e.y),0!==n.rotation&&K.rotate(n.rotation),K.scale(i,-o),K.fillRect(-.5,-.5,1,1),K.restore()}else n.isSpriteCanvasMaterial?(v(n.color.getStyle()),T(n.color.getStyle()),K.save(),K.translate(e.x,e.y),0!==n.rotation&&K.rotate(n.rotation),K.scale(i,o),n.program(K),K.restore()):n.isPointsMaterial&&(T(n.color.getStyle()),K.save(),K.translate(e.x,e.y),0!==n.rotation&&K.rotate(n.rotation),K.scale(i*n.size,-o*n.size),K.fillRect(-.5,-.5,1,1),K.restore())}function o(e,t,n,i){if(u(i.opacity),d(i.blending),K.beginPath(),K.moveTo(e.positionScreen.x,e.positionScreen.y),K.lineTo(t.positionScreen.x,t.positionScreen.y),i.isLineBasicMaterial){if(E(i.linewidth),m(i.linecap),f(i.linejoin),i.vertexColors!==THREE.VertexColors)v(i.color.getStyle());else{var o=n.vertexColors[0].getStyle(),r=n.vertexColors[1].getStyle();if(o===r)v(o);else{try{var a=K.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,o),a.addColorStop(1,r)}catch(e){a=o}v(a)}}K.stroke(),me.expandByScalar(2*i.linewidth)}else i.isLineDashedMaterial&&(E(i.linewidth),m(i.linecap),f(i.linejoin),v(i.color.getStyle()),R([i.dashSize,i.gapSize]),K.stroke(),me.expandByScalar(2*i.linewidth),R([]))}function r(e,t,i,o,r,l,p,E){k.info.render.vertices+=3,k.info.render.faces++,u(E.opacity),d(E.blending),b=e.positionScreen.x,O=e.positionScreen.y,S=t.positionScreen.x,C=t.positionScreen.y,L=i.positionScreen.x,A=i.positionScreen.y,a(b,O,S,C,L,A),(E.isMeshLambertMaterial||E.isMeshPhongMaterial||E.isMeshStandardMaterial)&&null===E.map?(le.copy(E.color),he.copy(E.emissive),E.vertexColors===THREE.FaceColors&&le.multiply(p.color),ce.copy(fe),ye.copy(e.positionWorld).add(t.positionWorld).add(i.positionWorld).divideScalar(3),n(ye,p.normalModel,ce),ce.multiply(le).add(he),!0===E.wireframe?s(ce,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):c(ce)):E.isMeshBasicMaterial||E.isMeshLambertMaterial||E.isMeshPhongMaterial||E.isMeshStandardMaterial?null!==E.map?E.map.mapping===THREE.UVMapping&&(z=p.uvs,h(b,O,S,C,L,A,z[o].x,z[o].y,z[r].x,z[r].y,z[l].x,z[l].y,E.map)):null!==E.envMap?E.envMap.mapping===THREE.SphericalReflectionMapping&&(ge.copy(p.vertexNormalsModel[o]).applyMatrix3(Me),N=.5*ge.x+.5,j=.5*ge.y+.5,ge.copy(p.vertexNormalsModel[r]).applyMatrix3(Me),V=.5*ge.x+.5,D=.5*ge.y+.5,ge.copy(p.vertexNormalsModel[l]).applyMatrix3(Me),P=.5*ge.x+.5,U=.5*ge.y+.5,h(b,O,S,C,L,A,N,j,V,D,P,U,E.envMap)):(ce.copy(E.color),E.vertexColors===THREE.FaceColors&&ce.multiply(p.color),!0===E.wireframe?s(ce,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):c(ce)):E.isMeshNormalMaterial?(ge.copy(p.normalModel).applyMatrix3(Me),ce.setRGB(ge.x,ge.y,ge.z).multiplyScalar(.5).addScalar(.5),!0===E.wireframe?s(ce,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):c(ce)):(ce.setRGB(1,1,1),!0===E.wireframe?s(ce,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):c(ce))}function a(e,t,n,i,o,r){K.beginPath(),K.moveTo(e,t),K.lineTo(n,i),K.lineTo(o,r),K.closePath()}function s(e,t,n,i){E(t),m(n),f(i),v(e.getStyle()),K.stroke(),me.expandByScalar(2*t)}function c(e){T(e.getStyle()),K.fill()}function l(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var t=e.image;if(!1===t.complete)return{canvas:void 0,version:0};var n=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,i=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,o=e.wrapS===THREE.MirroredRepeatWrapping,r=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas");a.width=t.width*(o?2:1),a.height=t.height*(r?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,t.height),s.drawImage(t,0,0),!0===o&&(s.setTransform(-1,0,0,-1,t.width,t.height),s.drawImage(t,-t.width,0)),!0===r&&(s.setTransform(1,0,0,1,0,0),s.drawImage(t,0,t.height)),!0===o&&!0===r&&(s.setTransform(-1,0,0,1,t.width,0),s.drawImage(t,-t.width,t.height));var c="no-repeat";!0===n&&!0===i?c="repeat":!0===n?c="repeat-x":!0===i&&(c="repeat-y");var l=K.createPattern(a,c);return e.onUpdate&&e.onUpdate(e),{canvas:l,version:e.version}}function h(e,t,n,i,o,r,a,s,c,h,p,u,d){var E=ue[d.id];if(void 0!==E&&E.version===d.version||(E=l(d),ue[d.id]=E),void 0===E.canvas)return T("rgba( 0, 0, 0, 1)"),void K.fill();T(E.canvas);var m,f,v,R,y,g,M,x,w=d.offset.x/d.repeat.x,H=d.offset.y/d.repeat.y,b=d.image.width*d.repeat.x,O=d.image.height*d.repeat.y;c=(c+w)*b,h=(h+H)*O,p=(p+w)*b,u=(u+H)*O,n-=e,i-=t,o-=e,r-=t,0!==(M=(c-=a=(a+w)*b)*(u-=s=(s+H)*O)-(p-=a)*(h-=s))&&(y=e-(m=(u*n-h*o)*(x=1/M))*a-(v=(c*o-p*n)*x)*s,g=t-(f=(u*i-h*r)*x)*a-(R=(c*r-p*i)*x)*s,K.save(),K.transform(m,f,v,R,y,g),K.fill(),K.restore())}function p(e,t,n){var i,o=t.x-e.x,r=t.y-e.y,a=o*o+r*r;0!==a&&(o*=i=n/Math.sqrt(a),r*=i,t.x+=o,t.y+=r,e.x-=o,e.y-=r)}function u(e){ee!==e&&(K.globalAlpha=e,ee=e)}function d(e){te!==e&&(e===THREE.NormalBlending?K.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?K.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?K.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(K.globalCompositeOperation="multiply"),te=e)}function E(e){oe!==e&&(K.lineWidth=e,oe=e)}function m(e){re!==e&&(K.lineCap=e,re=e)}function f(e){ae!==e&&(K.lineJoin=e,ae=e)}function v(e){ne!==e&&(K.strokeStyle=e,ne=e)}function T(e){ie!==e&&(K.fillStyle=e,ie=e)}function R(e){se.length!==e.length&&(K.setLineDash(e),se=e)}console.log("THREE.CanvasRenderer",THREE.REVISION),e=e||{};var y,g,M,x,w,H,b,O,S,C,L,A,z,N,j,V,D,P,U,k=this,B=new THREE.Projector,I=void 0!==e.canvas?e.canvas:document.createElement("canvas"),Y=I.width,_=I.height,F=Math.floor(Y/2),X=Math.floor(_/2),W=0,Z=0,Q=Y,q=_,G=1,K=I.getContext("2d",{alpha:!0===e.alpha}),J=new THREE.Color(0),$=!0===e.alpha?0:1,ee=1,te=0,ne=null,ie=null,oe=null,re=null,ae=null,se=[],ce=new THREE.Color,le=new THREE.Color,he=new THREE.Color,pe=new THREE.Color,ue={},de=new THREE.Box2,Ee=new THREE.Box2,me=new THREE.Box2,fe=new THREE.Color,ve=new THREE.Color,Te=new THREE.Color,Re=new THREE.Vector3,ye=new THREE.Vector3,ge=new THREE.Vector3,Me=new THREE.Matrix3;void 0===K.setLineDash&&(K.setLineDash=function(){}),this.domElement=I,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return K},this.getContextAttributes=function(){return K.getContextAttributes()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(e){void 0!==e&&(G=e)},this.setSize=function(e,t,n){Y=e*G,_=t*G,I.width=Y,I.height=_,F=Math.floor(Y/2),X=Math.floor(_/2),!1!==n&&(I.style.width=e+"px",I.style.height=t+"px"),de.min.set(-F,-X),de.max.set(F,X),Ee.min.set(-F,-X),Ee.max.set(F,X),ee=1,te=0,ne=null,ie=null,oe=null,re=null,ae=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,n,i){W=e*G,Z=t*G,Q=n*G,q=i*G},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,t){J.set(e),$=void 0!==t?t:1,Ee.min.set(-F,-X),Ee.max.set(F,X)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return J},this.getClearAlpha=function(){return $},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===Ee.isEmpty()&&(Ee.intersect(de),Ee.expandByScalar(2),Ee.min.x=Ee.min.x+F,Ee.min.y=-Ee.min.y+X,Ee.max.x=Ee.max.x+F,Ee.max.y=-Ee.max.y+X,$<1&&K.clearRect(0|Ee.min.x,0|Ee.max.y,Ee.max.x-Ee.min.x|0,Ee.min.y-Ee.max.y|0),$>0&&(d(THREE.NormalBlending),u(1),T("rgba("+Math.floor(255*J.r)+","+Math.floor(255*J.g)+","+Math.floor(255*J.b)+","+$+")"),K.fillRect(0|Ee.min.x,0|Ee.max.y,Ee.max.x-Ee.min.x|0,Ee.min.y-Ee.max.y|0)),Ee.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,n){if(void 0!==n.isCamera){var a=e.background;a&&a.isColor?(T("rgb("+Math.floor(255*a.r)+","+Math.floor(255*a.g)+","+Math.floor(255*a.b)+")"),K.fillRect(0,0,Y,_)):!0===this.autoClear&&this.clear(),k.info.render.vertices=0,k.info.render.faces=0,K.setTransform(Q/Y,0,0,-q/_,W,_-Z),K.translate(F,X),y=B.projectScene(e,n,this.sortObjects,this.sortElements),g=y.elements,M=y.lights,Me.getNormalMatrix(n.matrixWorldInverse),t();for(var s=0,c=g.length;s<c;s++){var l=g[s],h=l.material;if(void 0!==h&&0!==h.opacity){if(me.makeEmpty(),l instanceof THREE.RenderableSprite)(x=l).x*=F,x.y*=X,i(x,l,h);else if(l instanceof THREE.RenderableLine)x=l.v1,w=l.v2,x.positionScreen.x*=F,x.positionScreen.y*=X,w.positionScreen.x*=F,w.positionScreen.y*=X,me.setFromPoints([x.positionScreen,w.positionScreen]),!0===de.intersectsBox(me)&&o(x,w,l,h);else if(l instanceof THREE.RenderableFace){if(x=l.v1,w=l.v2,H=l.v3,x.positionScreen.z<-1||x.positionScreen.z>1)continue;if(w.positionScreen.z<-1||w.positionScreen.z>1)continue;if(H.positionScreen.z<-1||H.positionScreen.z>1)continue;x.positionScreen.x*=F,x.positionScreen.y*=X,w.positionScreen.x*=F,w.positionScreen.y*=X,H.positionScreen.x*=F,H.positionScreen.y*=X,h.overdraw>0&&(p(x.positionScreen,w.positionScreen,h.overdraw),p(w.positionScreen,H.positionScreen,h.overdraw),p(H.positionScreen,x.positionScreen,h.overdraw)),me.setFromPoints([x.positionScreen,w.positionScreen,H.positionScreen]),!0===de.intersectsBox(me)&&r(x,w,H,0,1,2,l,h)}Ee.union(me)}}K.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.")}},THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*c.autoRotateSpeed}function i(){return Math.pow(.95,c.zoomSpeed)}function o(e){if(!1!==c.enabled){e.preventDefault();var t=c.domElement===document?c.domElement.body:c.domElement;if(O===b.ROTATE){if(!0===c.noRotate)return;h.set(e.clientX,e.clientY),p.subVectors(h,l),c.rotateLeft(2*Math.PI*p.x/t.clientWidth*c.rotateSpeed),c.rotateUp(2*Math.PI*p.y/t.clientHeight*c.rotateSpeed),l.copy(h)}else if(O===b.DOLLY){if(!0===c.noZoom)return;T.set(e.clientX,e.clientY),R.subVectors(T,v),R.y>0?c.dollyIn():c.dollyOut(),v.copy(T)}else if(O===b.PAN){if(!0===c.noPan)return;d.set(e.clientX,e.clientY),E.subVectors(d,u),c.pan(E.x,E.y),u.copy(d)}O!==b.NONE&&c.update()}}function r(){!1!==c.enabled&&(document.removeEventListener("mousemove",o,!1),document.removeEventListener("mouseup",r,!1),c.dispatchEvent(z),O=b.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var a,s,c=this,l=new THREE.Vector2,h=new THREE.Vector2,p=new THREE.Vector2,u=new THREE.Vector2,d=new THREE.Vector2,E=new THREE.Vector2,m=new THREE.Vector3,f=new THREE.Vector3,v=new THREE.Vector2,T=new THREE.Vector2,R=new THREE.Vector2,y=0,g=0,M=1,x=new THREE.Vector3,w=new THREE.Vector3,H=new THREE.Quaternion,b={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},O=b.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone();var S=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),C=S.clone().inverse(),L={type:"change"},A={type:"start"},z={type:"end"};this.rotateLeft=function(e){void 0===e&&(e=n()),g-=e},this.rotateUp=function(e){void 0===e&&(e=n()),y-=e},this.panLeft=function(e){var t=this.object.matrix.elements;m.set(t[0],t[1],t[2]),m.multiplyScalar(-e),x.add(m)},this.panUp=function(e){var t=this.object.matrix.elements;m.set(t[4],t[5],t[6]),m.multiplyScalar(e),x.add(m)},this.pan=function(e,t){var n=c.domElement===document?c.domElement.body:c.domElement;if(void 0!==c.object.fov){var i=c.object.position.clone().sub(c.target).length();i*=Math.tan(c.object.fov/2*Math.PI/180),c.panLeft(2*e*i/n.clientHeight),c.panUp(2*t*i/n.clientHeight)}else void 0!==c.object.top?(c.panLeft(e*(c.object.right-c.object.left)/n.clientWidth),c.panUp(t*(c.object.top-c.object.bottom)/n.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=i()),M/=e},this.dollyOut=function(e){void 0===e&&(e=i()),M*=e},this.update=function(){var e=this.object.position;f.copy(e).sub(this.target),f.applyQuaternion(S),a=Math.atan2(f.x,f.z),s=Math.atan2(Math.sqrt(f.x*f.x+f.z*f.z),f.y),this.autoRotate&&O===b.NONE&&this.rotateLeft(n()),a+=g,s+=y,a=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,a)),s=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,s)),s=Math.max(1e-6,Math.min(Math.PI-1e-6,s));var t=f.length()*M;t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(x),f.x=t*Math.sin(s)*Math.sin(a),f.y=t*Math.cos(s),f.z=t*Math.sin(s)*Math.cos(a),f.applyQuaternion(C),e.copy(this.target).add(f),this.object.lookAt(this.target),g=0,y=0,M=1,x.set(0,0,0),(w.distanceToSquared(this.object.position)>1e-6||8*(1-H.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(L),w.copy(this.object.position),H.copy(this.object.quaternion))},this.reset=function(){O=b.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.getPolarAngle=function(){return s},this.getAzimuthalAngle=function(){return a};var N=document.getElementById(wizio.vrplayercontainer);N.addEventListener("mousedown",function(e){if(!1!==c.enabled){if(e.button===c.mouseButtons.ORBIT){if(e.preventDefault(),!0===c.noRotate)return;O=b.ROTATE,l.set(e.clientX,e.clientY)}else if(e.button===c.mouseButtons.ZOOM){if(e.preventDefault(),!0===c.noZoom)return;O=b.DOLLY,v.set(e.clientX,e.clientY)}O!==b.NONE&&(document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",r,!1),c.dispatchEvent(A))}},!1),N.addEventListener("touchstart",function(e){if(!1!==c.enabled){switch(e.touches.length){case 1:if(!0===c.noRotate)return;O=b.TOUCH_ROTATE,l.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!0===c.noZoom)return;O=b.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);v.set(0,i);break;case 3:if(!0===c.noPan)return;O=b.TOUCH_PAN,u.set(e.touches[0].pageX,e.touches[0].pageY);break;default:O=b.NONE}O!==b.NONE&&c.dispatchEvent(A)}},!1),N.addEventListener("touchend",function(){!1!==c.enabled&&(c.dispatchEvent(z),O=b.NONE)},!1),N.addEventListener("touchmove",function(e){if(!1!==c.enabled){e.preventDefault(),e.stopPropagation();var t=c.domElement===document?c.domElement.body:c.domElement;switch(e.touches.length){case 1:if(!0===c.noRotate)return;if(O!==b.TOUCH_ROTATE)return;h.set(e.touches[0].pageX,e.touches[0].pageY),p.subVectors(h,l),c.rotateLeft(2*Math.PI*p.x/t.clientWidth*c.rotateSpeed),c.rotateUp(2*Math.PI*p.y/t.clientHeight*c.rotateSpeed),l.copy(h),c.update();break;case 2:if(!0===c.noZoom)return;if(O!==b.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(n*n+i*i);T.set(0,o),R.subVectors(T,v),R.y>0?c.dollyOut():c.dollyIn(),v.copy(T),c.update();break;case 3:if(!0===c.noPan)return;if(O!==b.TOUCH_PAN)return;d.set(e.touches[0].pageX,e.touches[0].pageY),E.subVectors(d,u),c.pan(E.x,E.y),u.copy(d),c.update();break;default:O=b.NONE}}},!1),N.addEventListener("keydown",function(e){if(!1!==c.enabled&&!0!==c.noKeys&&!0!==c.noPan)switch(e.keyCode){case c.keys.UP:c.pan(0,c.keyPanSpeed),c.update();break;case c.keys.BOTTOM:c.pan(0,-c.keyPanSpeed),c.update();break;case c.keys.LEFT:c.pan(c.keyPanSpeed,0),c.update();break;case c.keys.RIGHT:c.pan(-c.keyPanSpeed,0),c.update()}},!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;var DeviceOrientationController=function(e,t){this.object=e,this.element=t||document,this.freeze=!0,this.enableManualDrag=!1,this.enableManualZoom=!1,this.useQuaternions=!0,this.deviceOrientation={},this.screenOrientation=window.orientation||0;var n,i,o,r,a,s=0,c=0,l=0,h=0,p=new THREE.Quaternion,u=1,d=1,E=new THREE.Vector2,m=new THREE.Vector2,f={AUTO:0,MANUAL_ROTATE:1,MANUAL_ZOOM:2},v=f.AUTO,T={CALIBRATE_COMPASS:"compassneedscalibration",SCREEN_ORIENTATION:"orientationchange",MANUAL_CONTROL:"userinteraction",ZOOM_CONTROL:"zoom",ROTATE_CONTROL:"rotate"},R=window.innerHeight,y=2e3*Math.tan(THREE.Math.degToRad((this.object.fov||75)/2)),g=new THREE.Quaternion,M=function(){var e;return function(t){(e=arguments||{}).type=t,e.target=this,this.dispatchEvent(e)}.bind(this)}.bind(this)();this.constrainObjectFOV=function(){r=y*(window.innerHeight/R),a=THREE.Math.radToDeg(2*Math.atan(r/2e3)),this.object.fov=a}.bind(this),this.onDeviceOrientationChange=function(e){this.deviceOrientation=e}.bind(this),this.onScreenOrientationChange=function(){this.screenOrientation=window.orientation||0,M(T.SCREEN_ORIENTATION)}.bind(this),this.onCompassNeedsCalibration=function(e){e.preventDefault(),M(T.CALIBRATE_COMPASS)}.bind(this),this.onDocumentMouseDown=function(e){!0===this.enableManualDrag&&(e.preventDefault(),v=f.MANUAL_ROTATE,this.freeze=!0,p.copy(this.object.quaternion),s=l=e.pageX,c=h=e.pageY,n=1200/window.innerWidth*.2,i=800/window.innerHeight*.2,this.element.addEventListener("mousemove",this.onDocumentMouseMove,!1),this.element.addEventListener("mouseup",this.onDocumentMouseUp,!1),M(T.MANUAL_CONTROL+"start"),M(T.ROTATE_CONTROL+"start"))}.bind(this),this.onDocumentMouseMove=function(e){l=e.pageX,h=e.pageY}.bind(this),this.onDocumentMouseUp=function(e){this.element.removeEventListener("mousemove",this.onDocumentMouseMove,!1),this.element.removeEventListener("mouseup",this.onDocumentMouseUp,!1),v=f.AUTO,this.freeze=!1,M(T.MANUAL_CONTROL+"end"),M(T.ROTATE_CONTROL+"end")}.bind(this),this.onDocumentTouchStart=function(e){switch(e.touches.length){case 1:if(!0!==this.enableManualDrag)return;v=f.MANUAL_ROTATE,this.freeze=!0,p.copy(this.object.quaternion),s=l=e.touches[0].pageX,c=h=e.touches[0].pageY,n=1200/window.innerWidth*.1,i=800/window.innerHeight*.1,this.element.addEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.addEventListener("touchend",this.onDocumentTouchEnd,!1),M(T.MANUAL_CONTROL+"start"),M(T.ROTATE_CONTROL+"start");break;case 2:if(!0!==this.enableManualZoom)return;v=f.MANUAL_ZOOM,this.freeze=!0,o=this.object.fov,E.set(e.touches[0].pageX,e.touches[0].pageY),m.set(e.touches[1].pageX,e.touches[1].pageY),u=d=E.distanceTo(m),this.element.addEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.addEventListener("touchend",this.onDocumentTouchEnd,!1),M(T.MANUAL_CONTROL+"start"),M(T.ZOOM_CONTROL+"start")}}.bind(this),this.onDocumentTouchMove=function(e){switch(e.touches.length){case 1:l=e.touches[0].pageX,h=e.touches[0].pageY;break;case 2:E.set(e.touches[0].pageX,e.touches[0].pageY),m.set(e.touches[1].pageX,e.touches[1].pageY)}}.bind(this),this.onDocumentTouchEnd=function(e){this.element.removeEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.removeEventListener("touchend",this.onDocumentTouchEnd,!1),v===f.MANUAL_ROTATE?(v=f.AUTO,this.freeze=!1,M(T.MANUAL_CONTROL+"end"),M(T.ROTATE_CONTROL+"end")):v===f.MANUAL_ZOOM&&(this.constrainObjectFOV(),v=f.AUTO,this.freeze=!1,M(T.MANUAL_CONTROL+"end"),M(T.ZOOM_CONTROL+"end"))}.bind(this);var x=function(){var e=new THREE.Quaternion,t=new THREE.Euler,n=new THREE.Quaternion,i=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),o=0;return function(r,a,s,c){return t.set(a,r,-s,"YXZ"),e.setFromEuler(t),o=-c/2,n.set(0,Math.sin(o),0,Math.cos(o)),e.multiply(n),e.multiply(i),e}}(),w=function(){var e=new THREE.Matrix4,t=new THREE.Euler,n=new THREE.Euler,i=new THREE.Euler(-Math.PI/2,0,0,"YXZ"),o=new THREE.Matrix4,r=new THREE.Matrix4;return r.makeRotationFromEuler(i),function(i,a,s,c){return t.set(a,i,-s,"YXZ"),e.identity(),e.makeRotationFromEuler(t),n.set(0,-c,0,"YXZ"),o.identity(),o.makeRotationFromEuler(n),e.multiply(o),e.multiply(r),e}}();this.updateManualMove=function(){var e,t,r,a,T,R,y,M,x=new THREE.Euler(0,0,0,"YXZ"),w=new THREE.Quaternion,H=new THREE.Quaternion;return function(){H.copy(p),v===f.MANUAL_ROTATE?(e=(c-h)*i,t=(s-l)*n,r=THREE.Math.degToRad(e),a=THREE.Math.degToRad(t),w.set(0,Math.sin(a/2),0,Math.cos(a/2)),H.multiply(w),w.set(Math.sin(r/2),0,0,Math.cos(r/2)),H.multiply(w),T=x.setFromQuaternion(p,"YXZ").z,R=x.setFromQuaternion(H,"YXZ").z,y=x.setFromQuaternion(g||p,"YXZ").z,w.set(0,0,Math.sin((y-T)/2),Math.cos((y-T)/2)),p.multiply(w),w.set(0,0,Math.sin((y-R)/2),Math.cos((y-R)/2)),H.multiply(w),this.object.quaternion.copy(H)):v===f.MANUAL_ZOOM&&(d=E.distanceTo(m),(M=u/d)<=1&&(this.object.fov=o*M,this.object.updateProjectionMatrix()),g&&(T=x.setFromQuaternion(p,"YXZ").z,y=x.setFromQuaternion(g,"YXZ").z,w.set(0,0,Math.sin((y-T)/2),Math.cos((y-T)/2)),p.multiply(w),this.object.quaternion.copy(p)))}}(),this.updateDeviceMove=function(){var e,t,n,i,o;return function(){if(e=THREE.Math.degToRad(this.deviceOrientation.alpha||0),t=THREE.Math.degToRad(this.deviceOrientation.beta||0),n=THREE.Math.degToRad(this.deviceOrientation.gamma||0),i=THREE.Math.degToRad(this.screenOrientation||0),0!==e&&0!==t&&0!==n){if(this.useQuaternions?g=x(e,t,n,i):(o=w(e,t,n,i),g.setFromRotationMatrix(o)),this.freeze)return;this.object.quaternion.copy(g)}}}(),this.update=function(){this.updateDeviceMove(),v!==f.AUTO&&this.updateManualMove()},this.connect=function(){document.getElementById(wizio.vrplayercontainer).addEventListener("resize",this.constrainObjectFOV,!1),window.addEventListener("orientationchange",this.onScreenOrientationChange,!1),window.addEventListener("deviceorientation",this.onDeviceOrientationChange,!1),window.addEventListener("compassneedscalibration",this.onCompassNeedsCalibration,!1),this.freeze=!1},this.disconnect=function(){var e=document.getElementById(wizio.vrplayercontainer);this.freeze=!0,e.removeEventListener("resize",this.constrainObjectFOV,!1),window.removeEventListener("orientationchange",this.onScreenOrientationChange,!1),window.removeEventListener("deviceorientation",this.onDeviceOrientationChange,!1),window.removeEventListener("compassneedscalibration",this.onCompassNeedsCalibration,!1)}};DeviceOrientationController.prototype=Object.create(THREE.EventDispatcher.prototype);