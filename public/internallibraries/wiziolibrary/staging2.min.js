window.wizio=function(){function e(e){e.preventDefault(),g.raycaster=new THREE.Raycaster,g.mouse=new THREE.Vector2,g.mouse.x=e.clientX/window.innerWidth*2-1,g.mouse.y=-e.clientY/window.innerHeight*2+1,g.raycaster.setFromCamera(g.mouse,g.camera);var n=g.raycaster.intersectObjects(g.intersectObjects);return n.length>0?(n[0].object.children[0].visible=!0,g.loadingImageFlag=!0,void(g.currentHoverObject=n[0].object)):void(0!==Object.keys(g.currentHoverObject).length&&(g.currentHoverObject.children[0].visible=!1))}function n(){g.onMouseMoveFlag?g.element.removeEventListener("mousemove",e):g.element.addEventListener("mousemove",e),g.onMouseMoveFlag=!g.onMouseMoveFlag}function t(e,n){e.preventDefault(),g.raycaster=new THREE.Raycaster,g.mouse=new THREE.Vector2,g.mouse.x=e.clientX/window.innerWidth*2-1,g.mouse.y=-e.clientY/window.innerHeight*2+1,g.raycaster.setFromCamera(g.mouse,g.camera);var t=g.raycaster.intersectObjects(g.intersectObjects);if(t.length>0)return t[0].object.children.length>0&&!g.toggleCoordCollectionFlag&&(t[0].object.children[0].visible=!0),t[0].coordClick="x:"+t[0].point.x+", y:"+t[0].point.y+", z:"+t[0].point.z,g.loadingImageFlag=!0,g.currentHoverObject=t[0].object,n(t[0]);0!==Object.keys(g.currentHoverObject).length&&(g.currentHoverObject.children[0].visible=!1)}function i(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}function o(){for(var e=0;e<g.navpoints.length;e++)g.navpoints[e].lookAt(g.camera.position);g.controls.update(),m(),requestAnimationFrame(o)}function r(e,n){for(var t=[],i=[],o=0;o<e.imageUrls.length;o++)t.push(e.imageUrls[o]);for(o=0;o<e.navpoints.length;o++)i.push(e.navpoints[o]);a(t,function(e){c(),s(i,function(e){return g.element.removeEventListener("click",g.OnMouseClick),g.element.addEventListener("click",g.onMouseClick,!1),n("done")})})}function c(){for(var e=0;e<g.navpoints.length;e++)g.scene.remove(g.scene.getObjectByName(g.navpoints[e].name))}function a(e,n){THREE.ImageUtils.crossOrigin="";var t=new THREE.TextureLoader;if(t.crossOrigin="",0===e.length)return n("all images added");t.load(e[0],function(t){t.minFilter=THREE.LinearFilter,g.sphere&&u(g.scene.children);var i=new THREE.Mesh(new THREE.SphereGeometry(100,60,40),new THREE.MeshBasicMaterial({map:t}));i.scale.set(-1,1,1),g.sphere=i,g.sphere.material.side=THREE.DoubleSide,g.scene.add(g.sphere),e.shift(),g.currentHoverObject={},a(e,function(e){return n("done2")})})}function s(n,t){var i,o;if(0===n.length)return g.currentHoverObject={},g.element.removeEventListener("mousemove",e),g.onMouseMoveFlag=!0,g.element.addEventListener("mousemove",e,!1),t("spritesloadede");i=(o=n[0]).name.includes("Kitchen")?"./public/viewtemplates/images/favicons/kitchen-icon.png":o.name.includes("Bathroom")||o.name.includes("Shower")||o.name.includes("Bath")?"./public/viewtemplates/images/favicons/bathroom-icon.png":o.name.includes("Bedroom")?"./public/viewtemplates/images/favicons/bedroom-icon.png":o.name.includes("Dining")?"./public/viewtemplates/images/favicons/diningroom-icon.png":o.name.includes("Living")?"./public/viewtemplates/images/favicons/livingroom-icon.png":"./public/viewtemplates/images/favicons/starburst-icon.png";var r=new THREE.TextureLoader;r.crossOrigin="",r.load(i,function(e){e.minFilter=THREE.LinearFilter;var i=new THREE.CircleGeometry(5,25),o=new THREE.MeshBasicMaterial({map:e,side:THREE.DoubleSide,transparent:!0}),r=new THREE.Mesh(i,o),c=new THREE.CircleGeometry(5,25),a=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.4,side:THREE.FrontSide}),l=new THREE.Mesh(c,a);l.visible=!1,g.scene.add(r),r.add(l),r.name=n[0].name,r.position.set(n[0].x,n[0].y,n[0].z),r.onUserAction=n[0].targetImageURLs,r.position.set(n[0].x,n[0].y,n[0].z),g.intersectObjects.push(r),g.navpoints.push(r),n.shift(),g.currentHoverObject={},s(n,function(e){t("imageLoaded")})})}function l(e){return e.includes("Kitchen")?"./public/viewtemplates/images/favicons/kitchen-icon.png":e.includes("Bathroom")||e.includes("Shower")||e.includes("Bath")?"./public/viewtemplates/images/favicons/bathroom-icon.png":e.includes("Bedroom")?"./public/viewtemplates/images/favicons/bedroom-icon.png":e.includes("Dining")?"./public/viewtemplates/images/favicons/diningroom-icon.png":e.includes("Living")?"./public/viewtemplates/images/favicons/livingroom-icon.png":"./public/viewtemplates/images/favicons/starburst-icon.png"}function d(){g.height=g.element.offsetHeight,g.width=g.element.offsetWidth,g.camera.aspect=g.width/g.height,g.camera.updateProjectionMatrix(),g.renderer.setSize(g.width,g.height),m()}function m(e,n,t){g.renderer.sortObjects=!1,g.renderer.render(g.scene,g.camera)}function u(e){for(;g.scene.children.length>0;)g.scene.remove(g.scene.children[0])}var g={};return g.init=function(e,n,t,c){var a,s,l,m,u;if(a=document.getElementById(e),g.vrplayercontainer=e,containerWidth=a.offsetHeight,containerHeight=a.offsetWidth,s=new THREE.PerspectiveCamera(100,containerWidth/containerHeight,.03,1e3),s.position.x=.1,s.position.y=0,s.position.z=0,l=new THREE.OrbitControls(s),l.noPan=!0,l.noZoom=!0,l.autoRotate=!0,l.autoRotateSpeed=.3,m=new THREE.Scene,(u=i()?new THREE.WebGLRenderer({preserveDrawingBuffer:!1,antialias:!0}):new THREE.CanvasRenderer).setSize(containerWidth,containerHeight),a.appendChild(u.domElement),window.addEventListener("resize",d,!1),g.accelFlag=!1,g.renderer=u,g.scene=m,g.controls=l,g.camera=s,g.element=a,g.height=containerHeight,g.width=containerWidth,g.navpoints=[],g.navpointBorders=[],g.intersectObjects=[],g.intersectingObjects=[],g.spriteObjects=[],o(),d(),!n)return c("initialized");r(n,function(){return c("initialized")})},g.dropNavPoint=function(e,n){var t,i,o,r,c,a,s;e.logoURL=l(e.name),(t=new THREE.TextureLoader).crossOrigin="",t.load(e.logoURL,function(n){i=new THREE.CircleGeometry(5,25),o=new THREE.MeshBasicMaterial({map:n,side:THREE.DoubleSide,transparent:!0}),r=new THREE.Mesh(i,o),c=new THREE.CircleGeometry(5,25),a=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.4,side:THREE.FrontSide}),s=new THREE.Mesh(c,a),g.scene.add(r),r.add(s),s.visible=!1,r.name=e.name,r.onUserAction=e.targetImageURLs,r.position.set(e.x,e.y,e.z),s.position.set(e.x,e.y,e.z),g.intersectObjects.push(r),g.navpoints.push(r),g.currentHoverObject={}})},g.getCoords=t,g.toggleAccelerometer=function(){g.accelFlag=!g.accelFlag,g.accelFlag?(g.controls=new DeviceOrientationController(g.camera),g.controls.connect(),g.controls.update()):(g.controls=new THREE.OrbitControls(g.camera),g.controls.noPan=!0,g.controls.noZoom=!0,g.controls.update())},g.changeImage=r,g.kll=u,g.onMouseClick=t,g.toggleCoordCollection=function(){if(g.toggleCoordCollectionFlag){n(),g.toggleCoordCollectionFlag=!1;for(var e=0;e<g.scene.children.length;e++)"coordCollectionSphere"===g.scene.children[e].name&&(g.scene.remove(g.scene.children[e]),g.intersectObjects=[],g.currentHoverObject={})}else{g.toggleCoordCollectionFlag=!0,n();var t=new THREE.Mesh(new THREE.SphereGeometry(40,60,40),new THREE.MeshBasicMaterial({transparent:!0,side:THREE.BackSide}));t.name="coordCollectionSphere",t.scale.set(-1,1,1),g.scene.add(t),g.intersectObjects=[t]}},g.onClickTriggered=t,g.disableOnMouseMove=function(){g.onMouseMoveFlag=!1,g.element.removeEventListener("mousemove",e)},g.dispose=function(){for(;g.scene.children.length>0;)g.scene.remove(g.scene.children[0]);g.renderer.dispose(),g={}},g}();